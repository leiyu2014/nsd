{"name":"Nsd","tagline":"for study of nsd","body":"##################################################################\r\n###################### DNS分离解析+虚拟web主机搭建记录###############\r\n##################################################################\r\n\r\n++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\r\n1、服务器准备\r\nCentOs7最小化安装+链接克隆+（Mem.512M,Hd.15G）\r\nDNS服务器(svr-dns)：192.168.4.7    \r\nweb1服务器(svr-web1)：192.168.4.10\r\nweb2服务器(svr-web2)：192.168.4.20\r\n客户端服务器(clients)：192.168.4.207（208）\r\n++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\r\n2、环境准备\r\n2.1 用户root/leiyu\r\n2.2 主机名\r\n\thostname   XXXX\r\n\techo  XXXX > /etc/hostname\r\n2.3 SELinux\r\n\tsetenforce  0\r\n\t/etc/selinux/config :SELINUX=permissive\r\n\r\n2.4 firewall\r\n\tfirewall-cmd --set-default-zone=trusted\r\n2.5 IP\r\n\t网卡名修改（省略一万字）\r\n\tnmcli connection modify eth0 ipv4.method manual ipv4.addresses\r\n\tXXXX/24  ipv4.gateway 192.168.4.254 connection.autoconnect yes\r\n\tnmcli connection up eth0\r\n\t验证：ip address show  \r\n\t      ip route   show\r\n2.6 DNS\r\n\techo nameserver  192.168.4.7 > /etc/resolv.conf\r\n\t\r\n2.7 yum搭建\r\n\t2.7.1自动挂载cdrom\r\n\t\tvi   /etc/fstab \r\n\t\t/dev/cdrom    /dvd   iso9660     defaults     0  0\r\n\t\tmount -a\r\n\t2.7.2yum配置文件\r\n\tvi dvd.repo \r\n\r\n\t[dvd]\r\n\tname=\"centos7-cdrom\"\r\n\tbaseurl=file:///dvd\r\n\tenabled=1\r\n\tgpgcheck=0\r\n\t2.7.3\r\n\tyum makecache\r\n\tyum repolist\r\n+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\r\n3.DNS分离解析服务搭建（192.168.4.7）\r\n\t3.1 DNS主配置文件修改\r\n\tvi /etc/named.conf\r\n\toptions {\r\n\t\tdirectory \t\"/var/named\";\r\n\t};\r\n\tview \"client207\" {\r\n\t\tmatch-clients { 192.168.4.207; };\r\n\t\tzone \"163.com\" IN { \r\n\t\ttype master;\r\n\t\tfile \"163.com.zone\";\r\n\t\t};\r\n\t\tzone \"qq.com\" IN { \r\n\t\ttype master;\r\n\t\tfile \"qq.com.zone\";\r\n\t\t};\t\r\n\t};\r\n\r\n\tview \"client208\" {\r\n\t\tmatch-clients { any; };\r\n\t\tzone \"163.com\" IN { \r\n\t\ttype master;\r\n\t\tfile \"163.com.other\";\r\n\t\t};\r\n\t\tzone \"qq.com\" IN { \r\n\t\ttype master;\r\n\t\tfile \"qq.com.other\";\r\n\t\t};\t\r\n\t};\r\n\t3.2 建立地址库文件\r\n\t163.com.zone\r\n\t$TTL 1D\r\n\t@\tIN SOA\t@ rname.invalid. (\r\n\t\t\t\t\t0\t; serial\r\n\t\t\t\t\t1D\t; refresh\r\n\t\t\t\t\t1H\t; retry\r\n\t\t\t\t\t1W\t; expire\r\n\t\t\t\t\t3H )\t; minimum\r\n\t163.com.\tNS\tsvr-dns\r\n\tsvr-dns\t\tA\t192.168.4.7\r\n\twww             A       192.168.4.10\r\n\r\n\t163.com.other\r\n\t$TTL 1D\r\n\t@\tIN SOA\t@ rname.invalid. (\r\n\t\t\t\t\t0\t; serial\r\n\t\t\t\t\t1D\t; refresh\r\n\t\t\t\t\t1H\t; retry\r\n\t\t\t\t\t1W\t; expire\r\n\t\t\t\t\t3H )\t; minimum\r\n\t163.com.\tNS\tsvr-dns\r\n\tsvr-dns\t\tA\t192.168.4.7\r\n\twww\t\tA       192.168.4.20\r\n\r\n\tqq.com.zone\r\n\t$TTL 1D\r\n\t@\tIN SOA\t@ rname.invalid. (\r\n\t\t\t\t\t0\t; serial\r\n\t\t\t\t\t1D\t; refresh\r\n\t\t\t\t\t1H\t; retry\r\n\t\t\t\t\t1W\t; expire\r\n\t\t\t\t\t3H )\t; minimum\r\n\tqq.com.\t\tNS\tsvr-dns\r\n\tsvr-dns\t\tA\t192.168.4.7\r\n\twww  \t\tA \t192.168.4.10\r\n\r\n\tqq.com.other\r\n\t$TTL 1D\r\n\t@\tIN SOA\t@ rname.invalid. (\r\n\t\t\t\t\t0\t; serial\r\n\t\t\t\t\t1D\t; refresh\r\n\t\t\t\t\t1H\t; retry\r\n\t\t\t\t\t1W\t; expire\r\n\t\t\t\t\t3H )\t; minimum\r\n\tqq.com.\t\tNS\tsvr-dns\r\n\tsvr-dns\t\tA\t192.168.4.7\r\n\twww\t\tA\t192.168.4.20\r\n\r\n\t3.3重启DNS服务\r\n\tsystemctl restart named\r\n\r\n\t3.4测试验证\r\n\tnslookup  www.163.com\r\n\tnslookup  www.qq.com\r\n\t--ps: 使用nslookup需要先安装 bind-utils\r\n++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\r\n4. 虚拟web主机搭建（192.168.4.10|20）\r\n\t4.1服务安装\r\n\tyum -y install httpd\r\n\t4.2创建web应用目录\r\n\tmkdir -p /var/www/webs/163\r\n\tmkdir -p /var/www/webs/qq\r\n\t4.3编写index文件\r\n\techo \"Love is colorbind . From 192.168.4.10(20)\" > /var/www/webs/163/index.html\r\n\techo \"Layast won't fail . From 192.168.4.10(20)\" > /var/www/webs/qq/index.html\r\n\t4.2修改主配置文件/etc/httpd/conf/httpd.conf\r\n\t增加：\r\n\t<Directory \"/var/www/webs/163\">\r\n        AllowOverride none\r\n        Require all granted\r\n\t</Directory>\r\n\r\n\t<Directory \"/var/www/webs/qq\">\r\n        AllowOverride none\r\n        Require all granted\r\n\t</Directory>\r\n\t4.3修改调用配置文件\r\n\t<VirtualHost *:80>\r\n\tServerName www.qq.com\r\n\tDocumentRoot /var/www/webs/qq\r\n\t</VirtualHost>\r\n\r\n\t<VirtualHost *:80>\r\n\tServerName www.163.com\r\n\tDocumentRoot /var/www.webs/163\r\n\t</VirtualHost>\r\n\r\n\t4.4 重启web服务\r\n\tsystemctl restart httpd\r\n\t\r\n\t4.5 访问验证\r\n\t192.168.4.207\r\n\t[root@clients ~]# curl www.163.com\r\n\tLove is colorbind . From 192.168.4.10\r\n\t[root@clients ~]# curl www.qq.com\r\n\tLayast won't fail . From 192.168.4.10\r\n\r\n\t192.168.4.208\r\n\t[root@clients ~]# curl www.qq.com\r\n\tLayast won't fail . From 192.168.4.20\r\n\t[root@clients ~]# curl www.163.com\r\n\tLove is colorbind . From 192.168.4.20\r\n\r\n\r\n\r\n\r\n\r\n\r\n","note":"Don't delete this file! It's used internally to help with page regeneration."}